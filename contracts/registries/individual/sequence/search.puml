@startuml Individual Registry - Search
!theme vibrant
participant Client as c
participant IndividualRegistry as ir
participant RedisCache as rc
database Database as db
c -> ir : /individual/v1/_search
activate ir
ir -> ir: Validate request body
alt request validation fails
    ir -> ir: Request validation failed
    ir -> c: HttpStatus: 200 OK with appropriate response code
end
ir -> ir: Request validation successful
alt search by clientReferenceId/individualId
    alt record doesn't exist
        ir -> rc: Search record based on clientReferenceId/individualId
        activate rc
        rc -> ir: 0 rows
        deactivate rc
        ir -> db: Search record based on clientReferenceId/individualId
        activate db
        db -> ir: 0 rows
        deactivate db
        ir -> c: HttpStatus: 400 with appropriate error code
        note left
          Error Code: RECORD_NOT_FOUND
        end note
    end
    alt record doesn't exists in cache
        ir -> rc: Search record based on clientReferenceId/individualId
        activate rc
        rc -> ir: 0 rows
        deactivate rc
        ir -> db: Search record based on clientReferenceId/individualId
        activate db
        db -> ir: 1 row
        deactivate db
        ir -> rc: 1 record
        activate rc
        deactivate rc
        ir -> c: HttpStatus: 200 with appropriate response code
    end
ir -> rc: Search record based on clientReferenceId/individualId
activate rc
rc -> ir: 1 row
deactivate rc
end
alt record doesn't exist for criteria
    ir -> db: Search record based on criteria
    activate db
    db -> ir: 0 rows
    deactivate db
    ir -> c: HttpStatus: 400 with appropriate error code
    note left
      Error Code: RECORD_NOT_FOUND
    end note
end
ir -> db: Search record based on criteria
activate db
db -> ir: 1-n rows
deactivate db
ir -> c: HttpStatus: 200 OK with found record(s)
deactivate ir
@enduml